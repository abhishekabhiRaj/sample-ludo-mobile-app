{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport AppState from \"react-native-web/dist/exports/AppState\";\nimport Linking from \"react-native-web/dist/exports/Linking\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { UnavailabilityError } from '@unimodules/core';\nimport ExponentWebBrowser from \"./ExpoWebBrowser\";\nvar emptyCustomTabsPackages = {\n  defaultBrowserPackage: undefined,\n  preferredBrowserPackage: undefined,\n  browserPackages: [],\n  servicePackages: []\n};\nexport function getCustomTabsSupportingBrowsersAsync() {\n  return _regeneratorRuntime.async(function getCustomTabsSupportingBrowsersAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (ExponentWebBrowser.getCustomTabsSupportingBrowsersAsync) {\n            _context.next = 2;\n            break;\n          }\n\n          throw new UnavailabilityError('WebBrowser', 'getCustomTabsSupportingBrowsersAsync');\n\n        case 2:\n          if (!(Platform.OS !== 'android')) {\n            _context.next = 6;\n            break;\n          }\n\n          return _context.abrupt(\"return\", emptyCustomTabsPackages);\n\n        case 6:\n          _context.next = 8;\n          return _regeneratorRuntime.awrap(ExponentWebBrowser.getCustomTabsSupportingBrowsersAsync());\n\n        case 8:\n          return _context.abrupt(\"return\", _context.sent);\n\n        case 9:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  });\n}\nexport function warmUpAsync(browserPackage) {\n  return _regeneratorRuntime.async(function warmUpAsync$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          if (ExponentWebBrowser.warmUpAsync) {\n            _context2.next = 2;\n            break;\n          }\n\n          throw new UnavailabilityError('WebBrowser', 'warmUpAsync');\n\n        case 2:\n          if (!(Platform.OS !== 'android')) {\n            _context2.next = 6;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", {});\n\n        case 6:\n          _context2.next = 8;\n          return _regeneratorRuntime.awrap(ExponentWebBrowser.warmUpAsync(browserPackage));\n\n        case 8:\n          return _context2.abrupt(\"return\", _context2.sent);\n\n        case 9:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  });\n}\nexport function mayInitWithUrlAsync(url, browserPackage) {\n  return _regeneratorRuntime.async(function mayInitWithUrlAsync$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          if (ExponentWebBrowser.mayInitWithUrlAsync) {\n            _context3.next = 2;\n            break;\n          }\n\n          throw new UnavailabilityError('WebBrowser', 'mayInitWithUrlAsync');\n\n        case 2:\n          if (!(Platform.OS !== 'android')) {\n            _context3.next = 6;\n            break;\n          }\n\n          return _context3.abrupt(\"return\", {});\n\n        case 6:\n          _context3.next = 8;\n          return _regeneratorRuntime.awrap(ExponentWebBrowser.mayInitWithUrlAsync(url, browserPackage));\n\n        case 8:\n          return _context3.abrupt(\"return\", _context3.sent);\n\n        case 9:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  });\n}\nexport function coolDownAsync(browserPackage) {\n  return _regeneratorRuntime.async(function coolDownAsync$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          if (ExponentWebBrowser.coolDownAsync) {\n            _context4.next = 2;\n            break;\n          }\n\n          throw new UnavailabilityError('WebBrowser', 'coolDownAsync');\n\n        case 2:\n          if (!(Platform.OS !== 'android')) {\n            _context4.next = 6;\n            break;\n          }\n\n          return _context4.abrupt(\"return\", {});\n\n        case 6:\n          _context4.next = 8;\n          return _regeneratorRuntime.awrap(ExponentWebBrowser.coolDownAsync(browserPackage));\n\n        case 8:\n          return _context4.abrupt(\"return\", _context4.sent);\n\n        case 9:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  });\n}\nexport function openBrowserAsync(url) {\n  var browserParams,\n      _args5 = arguments;\n  return _regeneratorRuntime.async(function openBrowserAsync$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          browserParams = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : {};\n\n          if (ExponentWebBrowser.openBrowserAsync) {\n            _context5.next = 3;\n            break;\n          }\n\n          throw new UnavailabilityError('WebBrowser', 'openBrowserAsync');\n\n        case 3:\n          _context5.next = 5;\n          return _regeneratorRuntime.awrap(ExponentWebBrowser.openBrowserAsync(url, browserParams));\n\n        case 5:\n          return _context5.abrupt(\"return\", _context5.sent);\n\n        case 6:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  });\n}\nexport function dismissBrowser() {\n  if (!ExponentWebBrowser.dismissBrowser) {\n    throw new UnavailabilityError('WebBrowser', 'dismissBrowser');\n  }\n\n  ExponentWebBrowser.dismissBrowser();\n}\nexport function openAuthSessionAsync(url, redirectUrl) {\n  return _regeneratorRuntime.async(function openAuthSessionAsync$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          if (!_authSessionIsNativelySupported()) {\n            _context6.next = 6;\n            break;\n          }\n\n          if (ExponentWebBrowser.openAuthSessionAsync) {\n            _context6.next = 3;\n            break;\n          }\n\n          throw new UnavailabilityError('WebBrowser', 'openAuthSessionAsync');\n\n        case 3:\n          return _context6.abrupt(\"return\", ExponentWebBrowser.openAuthSessionAsync(url, redirectUrl));\n\n        case 6:\n          return _context6.abrupt(\"return\", _openAuthSessionPolyfillAsync(url, redirectUrl));\n\n        case 7:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  });\n}\nexport function dismissAuthSession() {\n  if (_authSessionIsNativelySupported()) {\n    if (!ExponentWebBrowser.dismissAuthSession) {\n      throw new UnavailabilityError('WebBrowser', 'dismissAuthSession');\n    }\n\n    ExponentWebBrowser.dismissAuthSession();\n  } else {\n    if (!ExponentWebBrowser.dismissBrowser) {\n      throw new UnavailabilityError('WebBrowser', 'dismissAuthSession');\n    }\n\n    ExponentWebBrowser.dismissBrowser();\n  }\n}\n\nfunction _authSessionIsNativelySupported() {\n  if (Platform.OS === 'android') {\n    return false;\n  }\n\n  var versionNumber = parseInt(String(Platform.Version), 10);\n  return versionNumber >= 11;\n}\n\nvar _redirectHandler = null;\nvar _onWebBrowserCloseAndroid = null;\n\nfunction _onAppStateChangeAndroid(state) {\n  if (state === 'active' && _onWebBrowserCloseAndroid) {\n    _onWebBrowserCloseAndroid();\n  }\n}\n\nfunction _openBrowserAndWaitAndroidAsync(startUrl) {\n  var appStateChangedToActive, result, _await$openBrowserAsy, type;\n\n  return _regeneratorRuntime.async(function _openBrowserAndWaitAndroidAsync$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          appStateChangedToActive = new Promise(function (resolve) {\n            _onWebBrowserCloseAndroid = resolve;\n            AppState.addEventListener('change', _onAppStateChangeAndroid);\n          });\n          result = {\n            type: 'cancel'\n          };\n          _context7.next = 4;\n          return _regeneratorRuntime.awrap(openBrowserAsync(startUrl));\n\n        case 4:\n          _await$openBrowserAsy = _context7.sent;\n          type = _await$openBrowserAsy.type;\n\n          if (!(type === 'opened')) {\n            _context7.next = 10;\n            break;\n          }\n\n          _context7.next = 9;\n          return _regeneratorRuntime.awrap(appStateChangedToActive);\n\n        case 9:\n          result = {\n            type: 'dismiss'\n          };\n\n        case 10:\n          AppState.removeEventListener('change', _onAppStateChangeAndroid);\n          _onWebBrowserCloseAndroid = null;\n          return _context7.abrupt(\"return\", result);\n\n        case 13:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  });\n}\n\nfunction _openAuthSessionPolyfillAsync(startUrl, returnUrl) {\n  return _regeneratorRuntime.async(function _openAuthSessionPolyfillAsync$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          if (!_redirectHandler) {\n            _context8.next = 2;\n            break;\n          }\n\n          throw new Error(\"The WebBrowser's auth session is in an invalid state with a redirect handler set when it should not be\");\n\n        case 2:\n          if (!_onWebBrowserCloseAndroid) {\n            _context8.next = 4;\n            break;\n          }\n\n          throw new Error(\"WebBrowser is already open, only one can be open at a time\");\n\n        case 4:\n          _context8.prev = 4;\n\n          if (!(Platform.OS === 'android')) {\n            _context8.next = 11;\n            break;\n          }\n\n          _context8.next = 8;\n          return _regeneratorRuntime.awrap(Promise.race([_openBrowserAndWaitAndroidAsync(startUrl), _waitForRedirectAsync(returnUrl)]));\n\n        case 8:\n          return _context8.abrupt(\"return\", _context8.sent);\n\n        case 11:\n          _context8.next = 13;\n          return _regeneratorRuntime.awrap(Promise.race([openBrowserAsync(startUrl), _waitForRedirectAsync(returnUrl)]));\n\n        case 13:\n          return _context8.abrupt(\"return\", _context8.sent);\n\n        case 14:\n          _context8.prev = 14;\n\n          if (ExponentWebBrowser.dismissBrowser) {\n            ExponentWebBrowser.dismissBrowser();\n          }\n\n          _stopWaitingForRedirect();\n\n          return _context8.finish(14);\n\n        case 18:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, [[4,, 14, 18]]);\n}\n\nfunction _stopWaitingForRedirect() {\n  if (!_redirectHandler) {\n    throw new Error(\"The WebBrowser auth session is in an invalid state with no redirect handler when one should be set\");\n  }\n\n  Linking.removeEventListener('url', _redirectHandler);\n  _redirectHandler = null;\n}\n\nfunction _waitForRedirectAsync(returnUrl) {\n  return new Promise(function (resolve) {\n    _redirectHandler = function _redirectHandler(event) {\n      if (event.url.startsWith(returnUrl)) {\n        resolve({\n          url: event.url,\n          type: 'success'\n        });\n      }\n    };\n\n    Linking.addEventListener('url', _redirectHandler);\n  });\n}","map":{"version":3,"sources":["../src/WebBrowser.ts"],"names":[],"mappings":"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","sourcesContent":["import { AppState, Linking, Platform, AppStateStatus } from 'react-native';\nimport { UnavailabilityError } from '@unimodules/core';\nimport ExponentWebBrowser from './ExpoWebBrowser';\n\nimport {\n  RedirectEvent,\n  OpenBrowserOptions,\n  AuthSessionResult,\n  CustomTabsBrowsersResults,\n  BrowserResult,\n  RedirectResult,\n  MayInitWithUrlResult,\n  WarmUpResult,\n  CoolDownResult,\n} from './WebBrowser.types';\n\nconst emptyCustomTabsPackages: CustomTabsBrowsersResults = {\n  defaultBrowserPackage: undefined,\n  preferredBrowserPackage: undefined,\n  browserPackages: [],\n  servicePackages: [],\n};\n\nexport async function getCustomTabsSupportingBrowsersAsync(): Promise<CustomTabsBrowsersResults> {\n  if (!ExponentWebBrowser.getCustomTabsSupportingBrowsersAsync) {\n    throw new UnavailabilityError('WebBrowser', 'getCustomTabsSupportingBrowsersAsync');\n  }\n  if (Platform.OS !== 'android') {\n    return emptyCustomTabsPackages;\n  } else {\n    return await ExponentWebBrowser.getCustomTabsSupportingBrowsersAsync();\n  }\n}\n\nexport async function warmUpAsync(browserPackage?: string): Promise<WarmUpResult> {\n  if (!ExponentWebBrowser.warmUpAsync) {\n    throw new UnavailabilityError('WebBrowser', 'warmUpAsync');\n  }\n  if (Platform.OS !== 'android') {\n    return {};\n  } else {\n    return await ExponentWebBrowser.warmUpAsync(browserPackage);\n  }\n}\n\nexport async function mayInitWithUrlAsync(\n  url: string,\n  browserPackage?: string\n): Promise<MayInitWithUrlResult> {\n  if (!ExponentWebBrowser.mayInitWithUrlAsync) {\n    throw new UnavailabilityError('WebBrowser', 'mayInitWithUrlAsync');\n  }\n  if (Platform.OS !== 'android') {\n    return {};\n  } else {\n    return await ExponentWebBrowser.mayInitWithUrlAsync(url, browserPackage);\n  }\n}\n\nexport async function coolDownAsync(browserPackage?: string): Promise<CoolDownResult> {\n  if (!ExponentWebBrowser.coolDownAsync) {\n    throw new UnavailabilityError('WebBrowser', 'coolDownAsync');\n  }\n  if (Platform.OS !== 'android') {\n    return {};\n  } else {\n    return await ExponentWebBrowser.coolDownAsync(browserPackage);\n  }\n}\n\nexport async function openBrowserAsync(\n  url: string,\n  browserParams: OpenBrowserOptions = {}\n): Promise<BrowserResult> {\n  if (!ExponentWebBrowser.openBrowserAsync) {\n    throw new UnavailabilityError('WebBrowser', 'openBrowserAsync');\n  }\n  return await ExponentWebBrowser.openBrowserAsync(url, browserParams);\n}\n\nexport function dismissBrowser(): void {\n  if (!ExponentWebBrowser.dismissBrowser) {\n    throw new UnavailabilityError('WebBrowser', 'dismissBrowser');\n  }\n  ExponentWebBrowser.dismissBrowser();\n}\n\nexport async function openAuthSessionAsync(\n  url: string,\n  redirectUrl: string\n): Promise<AuthSessionResult> {\n  if (_authSessionIsNativelySupported()) {\n    if (!ExponentWebBrowser.openAuthSessionAsync) {\n      throw new UnavailabilityError('WebBrowser', 'openAuthSessionAsync');\n    }\n    return ExponentWebBrowser.openAuthSessionAsync(url, redirectUrl);\n  } else {\n    return _openAuthSessionPolyfillAsync(url, redirectUrl);\n  }\n}\n\nexport function dismissAuthSession(): void {\n  if (_authSessionIsNativelySupported()) {\n    if (!ExponentWebBrowser.dismissAuthSession) {\n      throw new UnavailabilityError('WebBrowser', 'dismissAuthSession');\n    }\n    ExponentWebBrowser.dismissAuthSession();\n  } else {\n    if (!ExponentWebBrowser.dismissBrowser) {\n      throw new UnavailabilityError('WebBrowser', 'dismissAuthSession');\n    }\n    ExponentWebBrowser.dismissBrowser();\n  }\n}\n\n/* iOS <= 10 and Android polyfill for SFAuthenticationSession flow */\n\nfunction _authSessionIsNativelySupported(): boolean {\n  if (Platform.OS === 'android') {\n    return false;\n  }\n\n  const versionNumber = parseInt(String(Platform.Version), 10);\n  return versionNumber >= 11;\n}\n\nlet _redirectHandler: ((event: RedirectEvent) => void) | null = null;\n\n/*\n * openBrowserAsync on Android doesn't wait until closed, so we need to polyfill\n * it with AppState\n */\n\n// Store the `resolve` function from a Promise to fire when the AppState\n// returns to active\nlet _onWebBrowserCloseAndroid: null | (() => void) = null;\n\nfunction _onAppStateChangeAndroid(state: AppStateStatus) {\n  if (state === 'active' && _onWebBrowserCloseAndroid) {\n    _onWebBrowserCloseAndroid();\n  }\n}\n\nasync function _openBrowserAndWaitAndroidAsync(startUrl: string): Promise<BrowserResult> {\n  let appStateChangedToActive = new Promise(resolve => {\n    _onWebBrowserCloseAndroid = resolve;\n    AppState.addEventListener('change', _onAppStateChangeAndroid);\n  });\n\n  let result: BrowserResult = { type: 'cancel' };\n  let { type } = await openBrowserAsync(startUrl);\n\n  if (type === 'opened') {\n    await appStateChangedToActive;\n    result = { type: 'dismiss' };\n  }\n\n  AppState.removeEventListener('change', _onAppStateChangeAndroid);\n  _onWebBrowserCloseAndroid = null;\n  return result;\n}\n\nasync function _openAuthSessionPolyfillAsync(\n  startUrl: string,\n  returnUrl: string\n): Promise<AuthSessionResult> {\n  if (_redirectHandler) {\n    throw new Error(\n      `The WebBrowser's auth session is in an invalid state with a redirect handler set when it should not be`\n    );\n  }\n\n  if (_onWebBrowserCloseAndroid) {\n    throw new Error(`WebBrowser is already open, only one can be open at a time`);\n  }\n\n  try {\n    if (Platform.OS === 'android') {\n      return await Promise.race([\n        _openBrowserAndWaitAndroidAsync(startUrl),\n        _waitForRedirectAsync(returnUrl),\n      ]);\n    } else {\n      return await Promise.race([openBrowserAsync(startUrl), _waitForRedirectAsync(returnUrl)]);\n    }\n  } finally {\n    // We can't dismiss the browser on Android, only call this when it's available.\n    // Users on Android need to manually press the 'x' button in Chrome Custom Tabs, sadly.\n    if (ExponentWebBrowser.dismissBrowser) {\n      ExponentWebBrowser.dismissBrowser();\n    }\n\n    _stopWaitingForRedirect();\n  }\n}\n\nfunction _stopWaitingForRedirect() {\n  if (!_redirectHandler) {\n    throw new Error(\n      `The WebBrowser auth session is in an invalid state with no redirect handler when one should be set`\n    );\n  }\n\n  Linking.removeEventListener('url', _redirectHandler);\n  _redirectHandler = null;\n}\n\nfunction _waitForRedirectAsync(returnUrl: string): Promise<RedirectResult> {\n  return new Promise(resolve => {\n    _redirectHandler = (event: RedirectEvent) => {\n      if (event.url.startsWith(returnUrl)) {\n        resolve({ url: event.url, type: 'success' });\n      }\n    };\n\n    Linking.addEventListener('url', _redirectHandler);\n  });\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}